<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Force HTTPS
  RewriteCond %{HTTPS} off
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  # Force www (canonical domain is www.hillcopaint.com)
  RewriteCond %{HTTP_HOST} ^hillcopaint\.com$ [NC]
  RewriteRule ^(.*)$ https://www.hillcopaint.com/$1 [L,R=301]

  # Remove trailing slashes from URLs (canonical URLs have no trailing slash)
  # This prevents duplicate content issues in Google Search Console
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} (.+)/$
  RewriteRule ^(.+)/$ /$1 [R=301,L]

  # Serve static sitemap.xml directly (generated at build time)
  # RewriteRule ^sitemap\.xml$ sitemap.php [L]  # Disabled: causes 500 if edge function fails

  # City-specific redirects
  RewriteRule ^austin/?$ /service-areas/austin [R=301,L]
  RewriteRule ^west-lake-hills/?$ /service-areas/west-lake-hills [R=301,L]
  RewriteRule ^westlake/?$ /service-areas/west-lake-hills [R=301,L]
  RewriteRule ^tarrytown/?$ /service-areas/austin [R=301,L]
  RewriteRule ^rollingwood/?$ /service-areas/austin [R=301,L]
  RewriteRule ^hyde-park/?$ /service-areas/austin [R=301,L]
  RewriteRule ^clarksville/?$ /service-areas/austin [R=301,L]
  RewriteRule ^lakeway/?$ /service-areas/austin [R=301,L]
  RewriteRule ^bee-cave/?$ /service-areas/austin [R=301,L]
  RewriteRule ^dripping-springs/?$ /service-areas/austin [R=301,L]
  RewriteRule ^central-austin/?$ /service-areas/austin [R=301,L]
  RewriteRule ^east-austin/?$ /service-areas/austin [R=301,L]
  RewriteRule ^south-austin/?$ /service-areas/austin [R=301,L]
  RewriteRule ^north-austin/?$ /service-areas/austin [R=301,L]

  # Out-of-service-area city redirects (cities no longer served)
  RewriteRule ^pflugerville/?$ /service-areas [R=301,L]
  RewriteRule ^georgetown/?$ /service-areas [R=301,L]
  RewriteRule ^hutto/?$ /service-areas [R=301,L]
  RewriteRule ^round-rock/?$ /service-areas [R=301,L]
  RewriteRule ^round-rock-2/?$ /service-areas [R=301,L]
  RewriteRule ^leander/?$ /service-areas [R=301,L]
  RewriteRule ^cedar-park/?$ /service-areas [R=301,L]

  # Old service-area sub-paths (removed locations)
  RewriteRule ^service-areas/round-rock.*$ /service-areas [R=301,L]
  RewriteRule ^service-areas/leander.*$ /service-areas [R=301,L]
  RewriteRule ^service-areas/georgetown.*$ /service-areas [R=301,L]
  RewriteRule ^service-areas/pflugerville.*$ /service-areas [R=301,L]
  RewriteRule ^service-areas/hutto.*$ /service-areas [R=301,L]
  RewriteRule ^service-areas/cedar-park.*$ /service-areas [R=301,L]

  # Old geo area URL corrections
  RewriteRule ^areas/downtown-austin-luxury/old-west-austin$ /areas/downtown-austin-luxury/old-west-austin-central [R=301,L]

  # Estimate and quote redirects
  RewriteRule ^get-a-free-estimate/?$ /contact [R=301,L]
  RewriteRule ^estimate/?$ /contact [R=301,L]
  RewriteRule ^quote/?$ /contact [R=301,L]
  RewriteRule ^request-estimate/?$ /contact [R=301,L]
  RewriteRule ^free-estimate/?$ /contact [R=301,L]

  # Legal page redirects (fix Soft 404s)
  RewriteRule ^privacy-policy/?$ /privacy [R=301,L]
  RewriteRule ^terms-of-service/?$ /terms [R=301,L]
  RewriteRule ^terms-and-conditions/?$ /terms [R=301,L]

  # Service area redirects (fix Soft 404s)
  RewriteRule ^service-area/?$ /service-areas [R=301,L]

  # Non-service area location redirects
  RewriteRule ^interior-painting-leander/?$ /services/interior-painting [R=301,L]
  RewriteRule ^exterior-painting-leander/?$ /services/exterior-painting [R=301,L]
  RewriteRule ^cabinet-refinishing-leander/?$ /services/cabinet-refinishing [R=301,L]
  RewriteRule ^commercial-painting-leander/?$ /services/commercial [R=301,L]

  # Service redirects
  RewriteRule ^interior-painting/?$ /services/interior-painting [R=301,L]
  RewriteRule ^exterior-painting/?$ /services/exterior-painting [R=301,L]
  RewriteRule ^cabinet-refinishing/?$ /services/cabinet-refinishing [R=301,L]
  RewriteRule ^cabinet-painting/?$ /services/cabinet-refinishing [R=301,L]
  RewriteRule ^cabinet-staining/?$ /services/cabinet-refinishing [R=301,L]
  RewriteRule ^commercial-painting/?$ /services/commercial [R=301,L]
  RewriteRule ^commercial-painting-.*$ /services/commercial [R=301,L]
  RewriteRule ^commercial/?$ /services/commercial [R=301,L]
  RewriteRule ^painting-services/?$ /services [R=301,L]

  # Pattern-based service redirects (legacy URLs only - excludes valid service+location pages)
  RewriteRule ^residential-interior-.*$ /services/interior-painting [R=301,L]
  RewriteRule ^residential-exterior-.*$ /services/exterior-painting [R=301,L]
  RewriteRule ^residential-cabinet-.*$ /services/cabinet-refinishing [R=301,L]
  RewriteRule ^commercial-interior-.*$ /services/commercial [R=301,L]
  RewriteRule ^commercial-exterior-.*$ /services/commercial [R=301,L]
  RewriteRule ^industrial-.*$ /services/commercial [R=301,L]
  RewriteRule ^hotel-.*$ /services/commercial [R=301,L]
  RewriteRule ^residential-(fence|deck|porch|garage|stucco)-.*$ /services [R=301,L]
  RewriteRule ^service/.*$ /services [R=301,L]
  RewriteRule ^services/residential.*$ /services [R=301,L]
  RewriteRule ^services/commercial[^-].*$ /services/commercial [R=301,L]

  # Case variations
  RewriteRule ^Austin/?$ /service-areas/austin [R=301,L,NC]
  RewriteRule ^West-Lake-Hills/?$ /service-areas/west-lake-hills [R=301,L,NC]
  RewriteRule ^Westlake/?$ /service-areas/west-lake-hills [R=301,L,NC]
  RewriteRule ^Tarrytown/?$ /service-areas/austin [R=301,L,NC]

  # SPA routing - must be last
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [L]
</IfModule>

# Security headers
<IfModule mod_headers.c>
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-Content-Type-Options "nosniff"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/html "access plus 5 minutes"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 day"
  ExpiresByType image/png "access plus 1 day"
  ExpiresByType image/webp "access plus 1 day"
  ExpiresByType image/svg+xml "access plus 1 day"
  ExpiresByType application/xml "access plus 1 hour"
  ExpiresByType text/plain "access plus 1 hour"
</IfModule>
